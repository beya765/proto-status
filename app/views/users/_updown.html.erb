<script>
(function () {
  let uptime = '<%= @state.updated_at.strftime('%d') %>';
  let nowtime = Number('<%= Time.current.strftime('%d') %>') + 1;
  let dayp = <%= @state.point %>;
  let nowPoint = Number($('#point').text());

  // console.log(uptime,nowtime);
  // console.log(Number(uptime) < nowtime);
  // console.log('<%= @state.point.class %>');

  $('.preAction').on('click', function() {
    const preActionText = $('.preAction').text().trim()
    $('.action').val(preActionText)
  })

  $('.plus').on('click', function() {
    let score = $(this).prev('.star').raty('score');
    if(!score) score = 0;

    if(dayp > 0) {
      score++;
      if (score%3 == 0) {
        score = 3;
        const nowmax = $('#max').attr("value");
        const newmax =  $(this).prev().attr("id");
        (!$('#max').attr("value")) ? $('#max').val(newmax) : $('#max').val(nowmax + "," + newmax);
      }else {
        score %= 3;
      }

      $(this).prev('.star').raty('readOnly', false)
                          .raty('score', score)
                          .raty('readOnly', true)
      dayp--;
      $('#point').text(dayp);
    }
  });

  document.body.addEventListener('ajax:success', function(event) {
    nowPoint = Number($('#point').text());
  });
  $('.cancel').on('click', function() {
    // console.log(nowPoint,<%= @state.point %>);
    // ( nowPoint != <%= @state.point %> ) ? dayp = nowPoint : dayp = <%= @state.point %>;

    dayp = nowPoint;
    $('.star').raty('reload');
    $('#max').val("");
    $('#point').text(dayp);
  });
}());
</script>