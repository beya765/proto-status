<script>
  (function () {
    let uptime = '<%= @state.updated_at.strftime('%d') %>';
    let nowtime = Number('<%= Time.current.strftime('%d') %>') + 1;
    let dayp = <%= @state.point %>;
    let nowPoint = Number($('#point').text());

    // console.log(uptime,nowtime);
    // console.log(Number(uptime) < nowtime);
    // console.log('<%= @state.point.class %>');

    $('.preAction').on('click', function() {
      const preActionText = $('.preAction').text().trim()
      $('.action').val(preActionText)
    })

    $('.plus').on('click', function() {
      let ratyScore = $(this).prev().children('.star').raty('score');
      if(!ratyScore) ratyScore = 0;

      if(dayp > 0) {
        ratyScore++;
        if (ratyScore%3 == 0) {
          ratyScore = 3;
          const nowfull = $('#full').attr("value");
          const newfull =  $(this).prev().children('.star').attr("id");
          (!$('#full').attr("value")) ? $('#full').val(newfull) : $('#full').val(nowfull + "," + newfull);
        }else {
          ratyScore %= 3;
        }

        $(this).prev().children('.star').raty('readOnly', false)
                            .raty('score', ratyScore)
                            .raty('readOnly', true)
        dayp--;
        $('#point').text(dayp);
      }
    });

    document.body.addEventListener('ajax:success', function(event) {
      nowPoint = Number($('#point').text());
    });
    $('.cancel').on('click', function() {
      // console.log(nowPoint,<%= @state.point %>);
      // ( nowPoint != <%= @state.point %> ) ? dayp = nowPoint : dayp = <%= @state.point %>;

      dayp = nowPoint;
      $('.star').raty('reload');
      $('#full').val("");
      $('#point').text(dayp);
    });
  }());
</script>